<head>
    <!-- ... -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>


<!DOCTYPE html>
<html>

<head>
    <title>CRUD de Cadastro de Produtos</title>
</head>

<body>
    <h1>Cadastro de Produtos</h1>

    <form id="productForm">
        <label for="productName">Nome do Produto:</label>
        <input type="text" id="productName" required><br>

        <label for="productDescription">Descrição:</label>
        <textarea id="productDescription" required></textarea><br>

        <label for="productValue">Valor:</label>
        <input type="number" id="productValue" step="0.01" required><br>

        <button type="button" onclick="addProduct()">Cadastrar</button>
        document.getElementById('addProductButton').addEventListener('click', addProduct);
    </form>

    <h2>Lista de Produtos</h2>
    <ul id="productList">
        <!-- Os produtos serão adicionados aqui -->
    </ul>

    <div id="editForm" style="display: none;">
        <h2>Editar Produto</h2>
        <form id="editProductForm">
            <label for="editProductName">Nome do Produto:</label>
            <input type="text" id="editProductName" required><br>

            <label for="editProductDescription">Descrição:</label>
            <textarea id="editProductDescription" required></textarea><br>

            <label for="editProductValue">Valor:</label>
            <input type="number" id="editProductValue" step="0.01" required><br>

            <button type="button" onclick="updateProduct()">Salvar</button>
        </form>
    </div>

    <script>
        const productList = document.getElementById('productList');
        const productForm = document.getElementById('productForm');
        const editForm = document.getElementById('editForm');
        const editProductName = document.getElementById('editProductName');
        const editProductDescription = document.getElementById('editProductDescription');
        const editProductValue = document.getElementById('editProductValue');

        let editedLi = null;  // Armazena o <li> sendo editado
// ... (código existente)

function addProduct() {
const productName = document.getElementById('productName').value;
const productDescription = document.getElementById('productDescription').value;
const productValue = document.getElementById('productValue').value;

if (productName.trim() !== '' && productDescription.trim() !== '' && productValue !== '') {
const productData = {
name: productName,
description: productDescription,
value: productValue
};

$.ajax({
url: '/add_product',
type: 'POST',
contentType: 'application/json',
data: JSON.stringify(productData),
success: function(response) {
fetchProducts(); // Atualizar a lista de produtos após adicionar
productForm.reset();
}
});
}
}

function editProduct(button) {
// ... (código existente)
}

function updateProduct() {
const updatedName = editProductName.value;
const updatedDescription = editProductDescription.value;
const updatedValue = editProductValue.value;

const productData = {
id: editedLi.getAttribute('data-id'), // Adicione um atributo data-id ao <li>
    name: updatedName,
    description: updatedDescription,
    value: updatedValue
    };

    $.ajax({
    url: '/update_product',
    type: 'POST',
    contentType: 'application/json',
    data: JSON.stringify(productData),
    success: function(response) {
    fetchProducts(); // Atualizar a lista de produtos após editar
    editForm.style.display = 'none';
    clearEditForm();
    }
    });
    }

    function deleteProduct(button) {
    const li = button.parentNode;
    const productId = li.getAttribute('data-id');

    $.ajax({
    url: `/delete_product/${productId}`,
    type: 'DELETE',
    success: function(response) {
    fetchProducts(); // Atualizar a lista de produtos após excluir
    }
    });
    }

    // Função para buscar e exibir a lista de produtos
    function fetchProducts() {
    $.ajax({
    url: '/get_products',
    type: 'GET',
    success: function(products) {
    productList.innerHTML = ''; // Limpar a lista atual

    products.forEach(function(product, index) {
    const li = document.createElement('li');
    li.setAttribute('data-id', index);
    li.innerHTML = `
    <strong>${product.name}</strong><br>
    Descrição: ${product.description}<br>
    Valor: R$ ${product.value}<br>
    <button onclick="editProduct(this)">Editar</button>
    <button onclick="deleteProduct(this)">Excluir</button>
    `;
    productList.appendChild(li);
    });
    }
    });
    }

    // Chamar a função fetchProducts() ao carregar a página
    $(document).ready(function() {
    fetchProducts();
    });